{extend name="Template:base" /}
{block name="title"}基因检测-登录{/block}
{block name="other_css"}
<!-- other css -->
<!--<link rel='stylesheet' href='__PCRESOURCE__/css/home.css' type="text/css" />-->
<link rel='stylesheet' href='__PCRESOURCE__/css/login.css' type="text/css"/>
{/block}

{block name="body"}
<div class="wrapper page-login">
    {include file="Template:top" /}
    <div class="contents">
        <div class="content-box">
            <div class="content-from">
                <div class="form-title">
                    <img src="__COMMONRESOURCE__/images/logo.png"/>
                    <div class="cut"></div>
                    <span class="">登录</span>
                </div>
                <div class="form-type">
                    <div class="form-type-tab tab-active" data-for="#normal">
                        账号登录
                    </div>
                    <div class="form-type-tab" data-for="#mobile">
                        手机登录
                    </div>
                    <div class="active-line"></div>
                </div>

                <div class="form-input" id="normal">
                    <input type="text" class="def-input" id="key" placeholder="邮箱/用户名"/>
                    <input type="password" class="def-input" id="password" placeholder="密码"/>
                    <div class="bar">
                        <span class="remember"><input type="checkbox" id="remember"/><label
                                for="remember">&nbsp;记住密码</label></span>
                        <span class="register"><a href="#" class="">找回密码</a>&nbsp;/&nbsp;<a href="#" class="">注册新用户</a></span>
                    </div>
                </div>

                <div class="form-input" id="mobile" style="display: none;">
                    <input type="text" class="def-input" id="phone" placeholder="手机号"/>
                    <div class="def-input def-inputbtn">
                        <input type="password" id="code" placeholder="验证码"/>
                        <input type="button" class="def-input-btn" id="send_code" value="获取验证码"/>
                    </div>
                    <div class="bar">
                        <span class="register"><a href="#" class="">找回密码</a>&nbsp;/&nbsp;<a href="#" class="">注册新用户</a></span>
                    </div>
                </div>
                <div class="form-btn">
                    <input type="button" value="登录" id="login" class="def-input">
                </div>
                <div class="form-footer">
                    <span class="">其他方式登录：</span>
                    <a class="action-qq three_login" data-type="qq">
                        <img src="__PCRESOURCE__/images/register/qq_03.jpg"/>&nbsp;QQ登录
                    </a>
                    <a class="action-wc three_login" data-type="wechat">
                        <img src="__PCRESOURCE__/images/register/WeChat_03.jpg"/>&nbsp;微信登录
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{/block}

{block name="other_js"}
<!-- other js -->
<script src="__PCRESOURCE__/js/my.js" type="text/javascript"></script>
<script src="__PCRESOURCE__/js/login.js" type="application/javascript"></script>
<script>

    $(function () {
        var loginUrl = "{:url('User/login')}";
        var successUrl = "{:url('Index/index')}";

        $.my_init({
            animate: {
                enable: false
            },
            tabs: {
                enable: true
            }
        });

        login.init(loginUrl, successUrl);

        $("#send_code").click(function () {
            var mobile = $("#phone").val();
            if (mobile == '') {
                alert('请输入手机号');
                return;
            }
            $("#send_code").prop('disabled', true);
            var second = 20;
            $("#send_code").val(second + 's');
            var interval = setInterval(function () {
                second -= 1;
                if (second == 0) {
                    clearInterval(interval);
                    $("#send_code").prop('disabled', false);
                    $("#send_code").val('获取验证码');
                } else {
                    $("#send_code").val(second + 's');
                }
            }, 1000);
            var res = checkParam(mobile, 'mobile');
            if (res) {
                var sendUrl = "{:url('User/sendSms')}";
                $.post(sendUrl, {
                    mobile: mobile,
                    type: 'login'
                }, function (res) {
                    if (res.status_code != 200) {
                        alert(res.msg);
                        clearInterval(interval);
                        $("#send_code").prop('disabled', false);
                        $("#send_code").val('获取验证码');
                    }else{
                       alert(res.msg);
                    }
                })
            }else{
                alert('请输入正确的手机号');
                clearInterval(interval);
                $('#phone').val('');
                $("#send_code").prop('disabled', false);
                $("#send_code").val('获取验证码');
            }
        });

//        $("#login").click(function () {
//            var phone = $("#phone").val();
//            var code = $("#code").val();
//        });


        $(".three_login").click(function () {
            var type = $(this).data('type');
            window.location.href = "{:url('user/qrLogin')}?type=" + type;
        })
    })

    /**
     * 参数验证
     * @param param
     * @param describe
     * @returns {boolean}
     */
    function checkParam(param, describe) {
        var flag = true;
        var msg = '';
        switch (describe) {
            case "key":
                if (param.length < 1) {
                    $("#key").next(".state").addClass('state-error');
                    msg = '用户名不能为空';
                    flag = false;
                } else {
                    $("#key").next(".state").addClass('state-success');
                }
                break;
            case "pwd":
                if (param.length < 1) {
                    $("#pwd").next(".state").addClass('state-error');
                    msg = '密码不能为空';
                    flag = false;
                } else {
                    $("#pwd").next(".state").addClass('state-success');
                }
                break;
            case "sure_pwd":
                var pwd = $("#pwd").val();
                if (param.length < 1) {
                    $("#sure_pwd").next(".state").addClass('state-error');
                    msg = '确认密码不能为空';
                    flag = false;
                } else if (param != pwd) {
                    $("#sure_pwd").next(".state").addClass('state-error');
                    msg = '两次密码输入不一致';
                    flag = false;
                } else {
                    $("#sure_pwd").next(".state").addClass('state-success');
                }
                break;
            case "mobile":
                if (param.length == 0) {
                    $("#mobile").next(".state").addClass('state-error');
                    msg = '手机号不能为空';
                    flag = false;
                } else if (!(/^1\d{10}$/.test(param))) {
                    $("#mobile").next(".state").addClass('state-error');
                    msg = '手机号格式不正确';
                    flag = false;
                } else {
                    $("#mobile").next(".state").addClass('state-success');
                }
                break;
            case "code":
                if (param.length == 0) {
                    $("#code").next(".state").addClass('state-error');
                    msg = '验证码不能为空';
                    flag = false;
                } else if (!(/^\d{6}$/.test(param))) {
                    $("#code").next(".state").addClass('state-error');
                    msg = '验证码格式不正确';
                    flag = false;
                } else {
                    $("#code").next(".state").addClass('state-success');
                }
                break;
            default :
                break;
        }
        if (flag) {
            return true;
        } else {
            console.log(msg);
            return false;
        }
    }

</script>
{/block}